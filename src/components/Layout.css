.app-layout {
  display: grid;
  grid-template-columns: 260px 1fr 320px; /* Fixed Left, Fluid Center, Fixed Right */
  height: 100vh;
  width: 100vw;
  overflow: hidden;
  gap: 16px; /* Tighter gap */
  padding: 16px; /* Balanced padding */
  padding-top: env(safe-area-inset-top, 16px);
  padding-bottom: env(safe-area-inset-bottom, 16px);
  padding-left: env(safe-area-inset-left, 16px);
  padding-right: env(safe-area-inset-right, 16px);
  box-sizing: border-box;
  /* Centering Fix: Use max-width on container if screen is ultra wide */
  justify-content: center; 
  /* Removed align-content: center to prevent vertical collapse */
  grid-template-rows: 1fr; /* Force row to fill height */
  max-width: 1400px; /* Optimal reading width */
  margin: 0 auto; /* Center the grid wrapper */
}

.layout-sidebar {
  display: flex;
  flex-direction: column;
  height: 100%;
  overflow-y: auto;
  border-radius: 24px;
}

.layout-sidebar.left {
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.layout-sidebar.right {
    background: rgba(255, 255, 255, 0.5); /* Slightly more opaque for details */
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: -5px 0 20px rgba(0,0,0,0.05);
}

.layout-main {
  display: flex;
  justify-content: center;
  align-items: stretch; /* Force full height to prevent jitter */
  overflow-y: hidden; /* Main scroll handled by inner panels if needed, but Calendar fits screen */
  padding: 0 10px; 
  height: 100%; /* Ensure it fills parent grid cell */
}

/* Mobile Responsive */
@media (max-width: 1100px) {
    .app-layout {
        grid-template-columns: 80px 1fr 300px; /* Small icon nav */
    }
}

@media (max-width: 900px) {
    .app-layout {
        grid-template-columns: 1fr; /* Stacked */
        padding: 10px;
        gap: 10px;
        height: auto;
        min-height: 100vh;
        overflow-y: auto;
    }
    
    /* Left Sidebar: Drawer from Left */
    .layout-sidebar.left {
        display: flex; /* Re-enable for mobile */
        position: fixed;
        left: 0;
        top: 0;
        bottom: 0;
        width: 280px;
        z-index: 9999;
        transform: translateX(-110%);
        transition: transform 0.35s cubic-bezier(0.3, 0.8, 0.4, 1);
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 10px 0 30px rgba(0,0,0,0.1);
    }
    .layout-sidebar.left.open {
        transform: translateX(0);
    }
    
    /* Right Sidebar: Bottom Sheet style for iPhone */
    .layout-sidebar.right {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        top: 20%; /* Cover 80% of screen */
        width: 100%;
        border-radius: 24px 24px 0 0;
        z-index: 9999;
        transform: translateY(110%);
        transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 -10px 40px rgba(0,0,0,0.1);
        border: none;
        padding-bottom: env(safe-area-inset-bottom);
    }
    
    .layout-sidebar.right.open {
        transform: translateY(0);
    }

    /* Backdrop */
    .mobile-backdrop {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.3);
        backdrop-filter: blur(4px);
        z-index: 9990;
        animation: fadeIn 0.3s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
}
